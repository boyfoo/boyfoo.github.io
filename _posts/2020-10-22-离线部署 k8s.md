---
layout: post
title: '离线部署 k8s'
date: 2020-10-22
author: boyfoo
tags: k8s
---

### 准备工作

#### 关闭防火墙

* centos

```bash
$ systemctl stop firewalld
$ systemctl disable firewalld
```

* ubuntu

`TODO`

#### 关闭交换分区

* centos

```bash
# 临时关闭
$ swapoff -a
```
```bash
# 永久关闭 注释文件内容
$ vim /etc/fstab
#/swapfile none swap defaults 0 0
```
```bash
#查看关闭结果
$ free -m
# Swap 都为0表示关闭成功
Swap:             0           0           0
```

* ubuntu

`TODO`

#### 配置主机名称名称解析

```bash
$ vim /etc/hosts

192.168.205.121 node02
192.168.205.120 node01
```


#### 关闭 setlinux

* centos

```bash
# 临时
$ setenforce 0

# 永久
$ vim /etc/selinux/config
SELINUX=disabled
```

* ubuntu

`TODO`

#### 配置时间

以主节点时间为准，副节点获取主节点的时间为准

* centos

主节点:

```bash
$ yum install chrony -y

$ vim /etc/chrony.conf
# 以本地时间地址 注释其他server
server 127.127.1.0 iburst
# 允许该网段的副接口来请求
allow 192.168.205.0/24
local stratum 10

$ systemctl restart chronyd
$ systemctl enable chronyd

# 查看进程端口是否被监听
$ ss -unl | grep 123
```

副节点:

```bash
$ yum install chrony -y

$ vim /etc/chrony.conf
# 以本地时间地址 注释其他server
server [主节点IP] iburst

$ systemctl restart chronyd
$ systemctl enable chronyd

# 查看结果 ^*开头表示成功
$ chronyc sources
^* node01                       10   6    17    41  +8305ns[  +54us] +/-  160us
```

* ubuntu

`TODO`