---
layout: post
title: 'kubeadm 部署k8s'
date: 2020-11-06
author: boyfoo
tags: k8s
---

各机器根据官方要求，进行准备配置
#### 一、关闭对应设置

关闭防火墙

```bash
$ systemctl stop firewalld
$ systemctl disable firewalld
```

关闭交互分区

```bash
# 临时关闭
$ swapoff -a

# 永久关闭 注释文件内容
$ vim /etc/fstab
#/swapfile none swap defaults 0 0

#查看关闭结果
$ free -m
# Swap 都为0表示关闭成功
Swap:             0           0           0
```

关闭 setlinux

```bash
# 临时
$ setenforce 0

# 永久
$ vim /etc/selinux/config
SELINUX=disabled
```

桥接IPV4流量传递到iptables的链

```bash
$ cat > /etc/sysctl.d/k8s.conf << EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF

# 刷新生效
$ sudo sysctl --system
```

#### 二、 各主机配置 hosts

```bash
# 各台主机设置不一样的主机名称
$ hostnamectl set-hostname XXX001

# 配置解析地址
$ vim /etc/hosts

# 与主机名称相同
192.168.10.10   XXX001
192.168.10.11   XXX002
```

#### kubeadm

```bash
$ kubeadm init --apiserver-advertise-address=192.168.10.10 --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16

$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config

# node节点加入后

# 下载网络文件内容
https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml

修改--kube-subnet-mgr下一行添加 指定的网卡
- --iface=eth1   


#运行 
kubectl apply -f kube-flannel.yml

运行网络 
# 节点都为Ready
$ kubectl get nodes -o wide
```